name: Auto-Update Translations

on:
  push:
    branches: [ main ]
    paths:
      - 'lib/**.dart'

jobs:
  update-translations:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install gettext
        run: sudo apt-get install -y gettext

      - name: Extract Strings and Update PO Files
        run: |
          mkdir -p assets/translations
          # Search for tr('...') or tr("...") in the code
          find lib -name "*.dart" | xgettext -f - \
              --from-code=UTF-8 \
              --language=Python \
              --keyword=tr \
              --output=assets/translations/app.pot || touch assets/translations/app.pot
          
          # Sync PO files with the new template
          [ -f assets/translations/en.po ] && msgmerge -U assets/translations/en.po assets/translations/app.pot || cp assets/translations/app.pot assets/translations/en.po
          [ -f assets/translations/he.po ] && msgmerge -U assets/translations/he.po assets/translations/app.pot || cp assets/translations/app.pot assets/translations/he.po

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "chore: update translation files"
          title: "üåç Translation Update"
          body: "Found new strings via tr() function."
          branch: translations-update